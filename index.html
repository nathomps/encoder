<html>
<head>
<script src="encoder.js"></script>
</head>

<body>
<div id="canvas"></div>
<div id="fileHolder"></div>

<script language=JavaScript>
var decoder = new Decoder();
var canvas = document.getElementById('canvas');
if (canvas) {
  canvas.innerHTML="<canvas id='pixelsCanvas' width='"+decoder.decoderFrameWidth+"' height='"+decoder.decoderFrameHeight+"' style='border:1px solid #d3d3d3;'>Your browser does not support HTML5 Canvas.</canvas>";
}

var fileHolder = document.getElementById('fileHolder');
// Check for the various File API support.
if (fileHolder) {
  if (window.File &&
      window.FileReader &&
      window.FileList &&
      window.Blob) {
    fileHolder.innerHTML = '<input type="file" id="fileSelector" name="video_source" />';

  } else {
    fileHolder.style['display'] = 'block';
    fileHolder.innerHTML = '<p>Browser Does Not Support HTML5 File API</p>';
  }
}

function copyFromDecoder(myCanvasContext, myDecoder) {
  var imageData = myCanvasContext.createImageData(myDecoder.decoderFrameWidth, myDecoder.decoderFrameHeight);
  console.log("0",myDecoder.decoderRgbaArray[0]);
  console.log("1",myDecoder.decoderRgbaArray[1]);
  console.log("2",myDecoder.decoderRgbaArray[2]);
  console.log("3",myDecoder.decoderRgbaArray[3]);
  for (var i = 0; i < myDecoder.decoderRgbaArray.length; i++) {
    imageData.data[i] = myDecoder.decoderRgbaArray[i];
  }
  myCanvasContext.putImageData(imageData, 0, 0);
}

var canvas = document.getElementById("pixelsCanvas");
var canvasContext = canvas.getContext("2d");
copyFromDecoder(canvasContext, decoder);

var handleFileSelect = function() {
    var localContext = canvasContext;
    var localDecoder = decoder;

  return function(evt) {
    var files = evt.target.files;
    for (var i = 0; i < files.length; i++) {
    	localDecoder.decode(files[i]);
      copyFromDecoder(localContext, localDecoder);
    }
  }
}();

document.getElementById('fileSelector').addEventListener('change', handleFileSelect, false);

</script>

</body>
</html>
